# Bicubic Search Engine

## Description
Bicubic Search Engine can enlarge the selected 2-dimension data to an arbitrary required size.  
The original image data is stored in ROM, and the image data after scaling will be written into SRAM by the bicubic search engine.  
It is a competition question for the preliminary round of IC Contest 2024 (Cell-based).  
You can check the path `./document/B_ICC2024_prelimily_grad_cell-based.pdf` to get the detailed design specifications.  
reference: [IC Contest 2024](https://www.iccontest2024.com/)

## Introduction to cubic interpolation
Let $p(x)$ be the pixel after scaling.  
Let $p(0)$ and p(1) are the left and right pixels adjacent to $p(x)$ respectively.  
Let $p(-1)$ be the pixels on the left side of $p(0)$ and $p(2)$ be the pixels on the right side of $p(1)$.  

![Bicubic_eq](https://github.com/jorjorrrrrr/ICDC/blob/main/14_Bicubic_Resize_Engine/fig/Bicubic_eq.png)  

Let $p(x) = ax^3 + bx^2 + cx + d$, where $0 \leq x \leq 1$.  
Known $p(0)$ and $p(1)$ that $p(0) = d$ and $p(1) = a + b + c + d$.  

In this question, we assume the slope of p(0) and p(1) are $\frac{p(1)-p(-1)}{2}$ and $\frac{p(2)-p(0)}{2}$ respectively.  
Known the slope equation $p'(x) = 3ax^2 + 2bx + c$.  
Then, we can get  
$p'(0) = c = \frac{p(1)-p(-1)}{2}$  
$p'(1) = a + b + c = \frac{p(2)-p(0)}{2}$  

According to the above equations, we can get  
$a = -\frac{1}{2}p(-1) + \frac{3}{2}p(0) - \frac{3}{2}p(1) + \frac{1}{2}p(2)$  
$b = p(-1) - \frac{5}{2}p(0) + 2p(1) - \frac{1}{2}p(2)$  
$c = -\frac{1}{2}p(-1) + \frac{1}{2}p(1)$  
$d = p(0)$  

Finally, substituting $a, b, c$ and $d$ into the original equation to get p(x).  

## Introduction to bicubic interpolation
One-dimensional cubic interpolation uses the values of 4 points to obtain an interpolated value.
As shown in the figure below, two-dimensional bicubic interpolation uses the values of 16 points to compute the interpolated value in an image.
The method involves first calculating the one-dimensional cubic interpolation results for each of the 4 horizontal red lines, 
and then using these 4 results to compute the one-dimensional cubic interpolation along the vertical green line.
It can be seen from this that a two-dimensional cubic interpolation is completed by performing five consecutive one-dimensional cubic interpolation operations.  

![Bicubic_interpolation](https://github.com/jorjorrrrrr/ICDC/blob/main/14_Bicubic_Resize_Engine/fig/Bicubic_interpolation.png)  

## Our design

![Bicubic_circuit](https://github.com/jorjorrrrrr/ICDC/blob/main/14_Bicubic_Resize_Engine/fig/Bicubic_circuit.png)

### ROM Control
Please review the code.

### RAM Control
Please review the code.

### Data Buffer
This module is created for storing the datas which is delivered from ROM.

### Multi_Div
This module is created for computing the new position information (x_new and y_new).
The integer part of them are used to determine the ROM's read address.
The floating part of them are used to calculate the one-dimensional cubic interpolation.

### 1D Cubic Interpolation module
Since the Bicubic Resize Engine involves a lot of one-dimensional cubic interpolation operations.
In our design, we only design an one-dimensional cubic interpolation module and implemented its shared functionality through a control unit.
Futhermore, the pipeline technique also be used in the one-dimensional cubic interpolation module to reduce the critical path.

### Control Unit
Please review the code.

## Finite State Machine

![FSM](https://github.com/jorjorrrrrr/ICDC/blob/main/14_Bicubic_Resize_Engine/fig/FSM.png)  

## File Description 
```
14_Bicubic_Resize_Engine
├── Bicubic.sdc
├── dat
│   ├── ImgROM.rcf
│   ├── pattern1
│   ├── pattern2
│   └── pattern3
├── document
│   └── B_ICC2024_prelimily_grad_cell-based.pdf
├── fig
│   ├── Bicubic_eq.png
│   ├── Bicubic_interpolation.png
│   └── Bicubic_Resize_Engine.png
├── lib
│   ├── ImgROM.pdf
│   ├── ImgROM_slow.db
│   ├── ImgROM_slow.lib
│   ├── ResultSRAM.pdf
│   ├── ResultSRAM_slow.db
│   └── ResultSRAM_slow.lib
├── Makefile
├── README.md
├── report
│   ├── area.log
│   ├── Bicubic_syn.qor
│   ├── power.log
│   └── timing.log
├── report.txt
├── rtl
│   ├── Bicubic.v
│   ├── ImgROM.v
│   ├── interpolation1d.v
│   ├── multi_div.v
│   ├── ResultSRAM.v
│   ├── sr.v
│   └── tb.sv
├── scripts
│   ├── dc_syn.tcl
│   └── pt_script.tcl
├── software
│   ├── Bicubic.ipynb
│   ├── ImgROM.rcf
│   ├── pattern1
│   ├── pattern2
│   └── pattern3
├── syn
└── synopsys_dc.setup
```

## Folder Description
```
- The lib folder is created to store the library and database of ROM and RAM.
- The rtl folder is created to store the Systemverilog or verilog code.
- The syn folder is created to store the files generated by Design Compiler.
- The dat folder is created to store the patterns.
- The report folder is created to store all the report about synthesis.
- The scripts folder is created to store the synthesis and pt script.
- The software folder is created to store the python code which can visualize the patterns.
- The document folder is created to store the specification files.
```

## Others Description
All the command can be refered to the `Makefile`.

## Results
|   Rank                     | A         |
|---------------             |---------  |
|   Technology               | TSMC130   |
|  Operating Frequency (MHz) | 125       |
|  Simulation Time           | 283732.0  |
|  Cell Area ($\mu m^2$)     | 699378.85 |        
|  Power (mW)                | 18.7      |

![pattern1](https://github.com/jorjorrrrrr/ICDC/blob/main/14_Bicubic_Resize_Engine/fig/pattern1.png)  
![pattern2](https://github.com/jorjorrrrrr/ICDC/blob/main/14_Bicubic_Resize_Engine/fig/pattern2.png)  
![pattern3](https://github.com/jorjorrrrrr/ICDC/blob/main/14_Bicubic_Resize_Engine/fig/pattern3.png)  
